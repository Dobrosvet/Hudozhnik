<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">

  <script src="../художник.js"></script>

  <script>

    окно.после_загрузки = async function () {
      луна                     = создать_луну()
      куб                      = await запрос( 'модели/урок_12_куб.json' )
      код_вершинного_шейдера   = await запрос( 'шейдеры/урок_12_вершинный_шейдер.glsl' )
      код_фрагментного_шейдера = await запрос( 'шейдеры/урок_12_фрагментный_шейдер.glsl' )

      таблица_соответствия_данным_модели_и_переменным_шейдеров = {
        вершины            : 'atribut_poziciya_vershin',
        координаты_текстуры: 'atribut_koordinaty_tekstury',
        нормали            : 'atribut_normali_vershin',
      }

      луна.данные_текстуры.путь_к_файлу = 'модели/' + луна.данные_текстуры.название_файла
      куб.данные_текстуры.путь_к_файлу  = 'модели/' + куб.данные_текстуры.название_файла

      холст_1    = Холст( 'холст_1' )
      художник_1 = Художник( холст_1, код_вершинного_шейдера, код_фрагментного_шейдера,
                             таблица_соответствия_данным_модели_и_переменным_шейдеров )

      холст_1.обработчик_опускания_клавиши_мыши   = обработчик_опускания_клавиши_мыши
      документ.обработчик_поднимания_клавиши_мыши = обработчик_поднимания_клавиши_мыши
      документ.обработчик_перемещения_мыши        = обработчик_перемещения_мыши

      луна.дистанция = 5
      луна.угол = 180
      куб.дистанция  = 5
      куб.угол = 0

      функции_для_постоянного_повторения.добавить( изменение_углов )
      function изменение_углов(  ) {
        луна.угол += 0.05 * время_с_последней_отсечки
        куб.угол  += 0.05 * время_с_последней_отсечки
      }

      художник_1.афинные_преобразования = function ( матрица_модель_вид, предмет ) {
        вращать_матрицу( матрица_модель_вид, градусы_в_радианы( предмет.угол ), [0.0, 1.0, 0.0] )
        перенести_матрицу( матрица_модель_вид, [предмет.дистанция, 0.0, 0.0] )
      }

      камера.расстояние_до_цели = 20.0

      художник_1.свет_включён            = да
      художник_1.цвет_фонового_освещения = [0.2, 0.2, 0.2]

      художник_1.позиция_источника_освещениея = [0.0, 0.0, -20.0]
      художник_1.цвет_источника_освещениея    = [0.8, 0.8, 0.8]


      художник_1.цвет_для_очистки = [0.0, 0.0, 0.0, 1.0]


      художник_1.нарисуй( [луна, куб] )
    }

    function создать_луну() {
      количество_граней_по_широте  = 30
      количество_граней_по_долготе = 30
      радиус                       = 2
      данные_координат_вершин      = []
      данные_нормалей              = []
      данные_координат_текстуры    = []
      for (let номер_по_широте = 0; номер_по_широте <= количество_граней_по_широте; номер_по_широте++) {
        let тета         = (номер_по_широте * 180 / количество_граней_по_широте)
        let синус_тета   = синус( тета )
        let косинус_тета = косинус( тета )

        for (let номер_по_долготе = 0; номер_по_долготе <= количество_граней_по_долготе; номер_по_долготе++) {
          let фи         = (номер_по_долготе * 2 * 180 / количество_граней_по_долготе)
          let синус_фи   = синус( фи )
          let косинус_фи = косинус( фи )

          let абсцисса             = косинус_фи * синус_тета
          let ордината             = косинус_тета
          let аппликата            = синус_фи * синус_тета
          let вертикаль_текстуры   = 1 - (номер_по_долготе / количество_граней_по_долготе)
          let горизонталь_текстуры = 1 - (номер_по_широте / количество_граней_по_широте)

          данные_нормалей.добавить( абсцисса )
          данные_нормалей.добавить( ордината )
          данные_нормалей.добавить( аппликата )
          данные_координат_текстуры.добавить( вертикаль_текстуры )
          данные_координат_текстуры.добавить( горизонталь_текстуры )
          данные_координат_вершин.добавить( радиус * абсцисса )
          данные_координат_вершин.добавить( радиус * ордината )
          данные_координат_вершин.добавить( радиус * аппликата )
        }
      }

      данные_индексов = []
      for (let номер_по_широте = 0; номер_по_широте < количество_граней_по_широте; номер_по_широте++) {
        for (let номер_по_долготе = 0; номер_по_долготе < количество_граней_по_долготе; номер_по_долготе++) {
          let первая_вершина = (номер_по_широте * (количество_граней_по_долготе + 1)) + номер_по_долготе
          let вторая_вершина = первая_вершина + количество_граней_по_долготе + 1
          данные_индексов.добавить( первая_вершина )
          данные_индексов.добавить( вторая_вершина )
          данные_индексов.добавить( первая_вершина + 1 )

          данные_индексов.добавить( вторая_вершина )
          данные_индексов.добавить( вторая_вершина + 1 )
          данные_индексов.добавить( первая_вершина + 1 )
        }
      }

      луна = {
        вершины        : данные_координат_вершин,
        индексы        : данные_индексов,
        нормали        : данные_нормалей,
        данные_текстуры: {
          название_файла: "moon.gif",
          координаты    : данные_координат_текстуры
        }
      }

      return луна
    }
  </script>

  <title>Урок 12. Точечное освещение</title>
</head>

<body>

<div id="контейнер">
  <canvas id="холст_1" width="500" height="500"></canvas>
  <div>
    <a href="index.html">< Назад</a>
  </div>
</div>

</body>
</html>