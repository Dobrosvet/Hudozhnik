<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">

  <script src="../художник.js"></script>

  <script>

    окно.после_загрузки = async function () {
      земля                                              = создать_землю()
      земля.данные_текстуры.путь_к_файлу                 =
        'модели/' + земля.данные_текстуры.название_файла
      земля.данные_текстуры.путь_к_файлу_карты_отражений =
        'модели/' + земля.данные_текстуры.название_файла_карты_отражений

      код_вершинного_шейдера_попиксельное_освещение   = await запрос( 'шейдеры/урок_15_вершинный_шейдер.glsl' )
      код_фрагментного_шейдера_попиксельное_освещение = await запрос( 'шейдеры/урок_15_фрагментный_шейдер.glsl' )

      таблица_соответствия_данным_модели_и_переменным_шейдеров = {
        вершины            : 'atribut_poziciya_vershin',
        координаты_текстуры: 'atribut_koordinaty_tekstury',
        нормали            : 'atribut_normali_vershin',
      }

      холст_1    = Холст( 'холст_1' )
      художник_1 = Художник( холст_1,
                             код_вершинного_шейдера_попиксельное_освещение,
                             код_фрагментного_шейдера_попиксельное_освещение,
                             таблица_соответствия_данным_модели_и_переменным_шейдеров )

      художник_1.цвет_для_очистки = [0.0, 0.0, 0.0, 1.0]

      земля.угол = 180

      функции_для_постоянного_повторения.добавить( изменение_углов )

      function изменение_углов() {
        земля.угол += 0.05 * время_с_последней_отсечки
      }

      художник_1.афинные_преобразования = function ( матрица_модель_вид, предмет ) {
        вращать_матрицу( матрица_модель_вид, градусы_в_радианы( предмет.угол ), [0.0, 1.0, 0.0] )
      }

      камера.расстояние_до_цели = 40.0
      камера.тангаж             = -23.4
      камера.крен               = 15.0

      художник_1.свет_включён             = да
      художник_1.карта_отражений_включена = да
      художник_1.карта_цветов_включена    = да


      художник_1.позиция_источника_освещениея = [-10.0, 4.0, -20.0]
      художник_1.цвет_источника_освещениея    = [5.0, 5.0, 5.0] // Цвет бликов
      художник_1.цвет_рассеянного_освещения   = [0.8, 0.8, 0.8]

      художник_1.цвет_фонового_освещения = [0.4, 0.4, 0.4]


      художник_1.нарисуй( [земля] )
    }

    function создать_землю() {
      количество_граней_по_широте  = 30
      количество_граней_по_долготе = 30
      радиус                       = 13
      данные_координат_вершин      = []
      данные_нормалей              = []
      данные_координат_текстуры    = []
      for (let номер_по_широте = 0; номер_по_широте <= количество_граней_по_широте; номер_по_широте++) {
        let тета         = (номер_по_широте * 180 / количество_граней_по_широте)
        let синус_тета   = синус( тета )
        let косинус_тета = косинус( тета )

        for (let номер_по_долготе = 0; номер_по_долготе <= количество_граней_по_долготе; номер_по_долготе++) {
          let фи         = (номер_по_долготе * 2 * 180 / количество_граней_по_долготе)
          let синус_фи   = синус( фи )
          let косинус_фи = косинус( фи )

          let абсцисса             = косинус_фи * синус_тета
          let ордината             = косинус_тета
          let аппликата            = синус_фи * синус_тета
          let вертикаль_текстуры   = 1 - (номер_по_долготе / количество_граней_по_долготе)
          let горизонталь_текстуры = 1 - (номер_по_широте / количество_граней_по_широте)

          данные_нормалей.добавить( абсцисса )
          данные_нормалей.добавить( ордината )
          данные_нормалей.добавить( аппликата )
          данные_координат_текстуры.добавить( вертикаль_текстуры )
          данные_координат_текстуры.добавить( горизонталь_текстуры )
          данные_координат_вершин.добавить( радиус * абсцисса )
          данные_координат_вершин.добавить( радиус * ордината )
          данные_координат_вершин.добавить( радиус * аппликата )
        }
      }

      данные_индексов = []
      for (let номер_по_широте = 0; номер_по_широте < количество_граней_по_широте; номер_по_широте++) {
        for (let номер_по_долготе = 0; номер_по_долготе < количество_граней_по_долготе; номер_по_долготе++) {
          let первая_вершина = (номер_по_широте * (количество_граней_по_долготе + 1)) + номер_по_долготе
          let вторая_вершина = первая_вершина + количество_граней_по_долготе + 1
          данные_индексов.добавить( первая_вершина )
          данные_индексов.добавить( вторая_вершина )
          данные_индексов.добавить( первая_вершина + 1 )

          данные_индексов.добавить( вторая_вершина )
          данные_индексов.добавить( вторая_вершина + 1 )
          данные_индексов.добавить( первая_вершина + 1 )
        }
      }

      земля = {
        вершины        : данные_координат_вершин,
        индексы        : данные_индексов,
        нормали        : данные_нормалей,
        данные_текстуры: {
          название_файла                : "earth.jpg",
          название_файла_карты_отражений: "earth-specular.gif",
          координаты                    : данные_координат_текстуры
        }
      }

      return земля
    }
  </script>

  <title>Урок 15. Карта отражений</title>
</head>

<body>

<div id="контейнер">
  <canvas id="холст_1" width="500" height="500"></canvas>
  <div>
    <a href="index.html">< Назад</a>
  </div>
</div>

</body>
</html>