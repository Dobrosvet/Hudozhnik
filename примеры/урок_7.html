<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">

  <script src="../художник.js"></script>

  <script>

    окно.после_загрузки = async function () {

      куб                      = await запрос( 'модели/урок_7_куб.json' )
      код_вершинного_шейдера   = await запрос( 'шейдеры/урок_7_вершинный_шейдер.glsl' )
      код_фрагментного_шейдера = await запрос( 'шейдеры/урок_7_фрагментный_шейдер.glsl' )

      таблица_соответствия_данным_модели_и_переменным_шейдеров = {
        вершины            : 'atribut_poziciya_vershin',
        координаты_текстуры: 'atribut_koordinaty_tekstury',
        нормали            : 'atribut_normali_vershin',
      }

      разворот_вокруг_оси_x           = 0
      скорость_разворота_вокруг_оси_x = 0
      разворот_вокруг_оси_y           = 0
      скорость_разворота_вокруг_оси_y = 0

      куб.координаты                   = [0, 0, 0]
      куб.углы_поворота                = [
        [() => разворот_вокруг_оси_x += (скорость_разворота_вокруг_оси_x * время_с_последней_отсечки) / 1000.0,
          [1, 0, 0]],
        [() => разворот_вокруг_оси_y += (скорость_разворота_вокруг_оси_y * время_с_последней_отсечки) / 1000.0,
          [0, 1, 0]],
        [0, [0, 0, 1]],
      ]
      куб.данные_текстуры.путь_к_файлу = 'модели/' + куб.данные_текстуры.название_файла

      текущие_нажатые_клавиши = []

      документ.добавить_выполнение_функции_к_событию_этого_объекта( 'keydown', обработчик_опускания_клавиш )
      документ.добавить_выполнение_функции_к_событию_этого_объекта( 'keyup', обработчик_поднимания_клавиш )

      функции_для_постоянного_повторения.добавить( обработчик_нажатий_клавиш )

      холст_1    = Холст( 'холст_1' )
      художник_1 = Художник( холст_1, код_вершинного_шейдера, код_фрагментного_шейдера,
                             таблица_соответствия_данным_модели_и_переменным_шейдеров )

      художник_1.свет_включён                 = да
      художник_1.направление_света            = [-0.25, -0.25, -1]
      художник_1.цвет_фонового_освещения      = [0.2, 0.2, 0.2]
      художник_1.цвет_направленного_освещения = [0.8, 0.8, 0.8]

      камера.расстояние_до_цели = -5

      художник_1.нарисуй( [куб] )
    }

    function обработчик_опускания_клавиш( событие ) {
      текущие_нажатые_клавиши[событие.код_клавиши] = да
    }

    function обработчик_поднимания_клавиш( событие ) {
      текущие_нажатые_клавиши[событие.код_клавиши] = нет
    }

    function обработчик_нажатий_клавиш() {
      // клавиша №33 'PageUp'
      if (текущие_нажатые_клавиши[33]) камера.расстояние_до_цели -= 0.05

      // клавиша №34 'PageDown'
      if (текущие_нажатые_клавиши[34]) камера.расстояние_до_цели += 0.05

      // клавиша №37 'стрелка влево' или №65 'Ф(рус)/A(анг)'
      if (текущие_нажатые_клавиши[37] || текущие_нажатые_клавиши[65]) скорость_разворота_вокруг_оси_y -= 1

      // клавиша №39 'стрелка вправо' или №68 'В(рус)/D(анг)'
      if (текущие_нажатые_клавиши[39] || текущие_нажатые_клавиши[68]) скорость_разворота_вокруг_оси_y += 1

      // клавиша №38 'стрелка вверх' или №87 'Ц(рус)/W(анг)'
      if (текущие_нажатые_клавиши[38] || текущие_нажатые_клавиши[87]) скорость_разворота_вокруг_оси_x -= 1

      // клавиша №40 'стрелка вниз' или №83 'Ы(рус)/S(анг)'
      if (текущие_нажатые_клавиши[40] || текущие_нажатые_клавиши[83]) скорость_разворота_вокруг_оси_x += 1
    }

  </script>

  <title>Урок 7. Основы фонового и направленного освещения</title>
</head>

<body>

<div id="контейнер">
  <canvas id="холст_1" width="500" height="500"></canvas>
  <div>
    <a href="index.html">< Назад</a>
  </div>
</div>

</body>
</html>