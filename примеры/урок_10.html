<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">

  <script src="../художник.js"></script>

  <script>

    окно.после_загрузки = async function () {

      сцена                    = await запрос( 'модели/урок_10_сцена.json' )
      код_вершинного_шейдера   = await запрос( 'шейдеры/урок_10_вершинный_шейдер.glsl' )
      код_фрагментного_шейдера = await запрос( 'шейдеры/урок_10_фрагментный_шейдер.glsl' )

      таблица_соответствия_данным_модели_и_переменным_шейдеров = {
        вершины            : 'atribut_poziciya_vershin',
        координаты_текстуры: 'atribut_koordinaty_tekstury',
      }

      сцена.данные_текстуры.путь_к_файлу = 'модели/' + сцена.данные_текстуры.название_файла

      текущие_нажатые_клавиши = []

      документ.добавить_выполнение_функции_к_событию_этого_объекта( 'keydown', обработчик_опускания_клавиш )
      документ.добавить_выполнение_функции_к_событию_этого_объекта( 'keyup', обработчик_поднимания_клавиш )

      функции_для_постоянного_повторения.добавить( изменение_параметров_камеры )
      функции_для_постоянного_повторения.добавить( обработчик_нажатий_клавиш )

      холст_1    = Холст( 'холст_1' )
      художник_1 = Художник( холст_1, код_вершинного_шейдера, код_фрагментного_шейдера,
                             таблица_соответствия_данным_модели_и_переменным_шейдеров )

      камера.ордината                                              = 0.4
      художник_1.отрисовка_треугольниками_с_вершинами_без_индексов = да

      художник_1.нарисуй( [сцена] )
    }

    угол_для_эмитации_бега = 0
    скорость               = 0
    боковая_скорость       = 0
    скорость_рыскания      = 0
    скорость_тангажа       = 0


    function изменение_параметров_камеры() {

      if (скорость !== 0 || боковая_скорость !== 0) {
        камера.абсцисса -= синус( камера.рыскание ) * скорость * время_с_последней_отсечки;
        камера.аппликата -= косинус( камера.рыскание ) * скорость * время_с_последней_отсечки;

        угол_для_эмитации_бега += время_с_последней_отсечки * 0.6;  // 0.6 "fiddle factor" -- makes it feel more realistic :-)
        камера.ордината = синус( угол_для_эмитации_бега ) / 20 + 0.4
      }
      камера.рыскание += скорость_рыскания * время_с_последней_отсечки
      камера.тангаж += скорость_тангажа * время_с_последней_отсечки

    }

    function обработчик_опускания_клавиш( событие ) {
      текущие_нажатые_клавиши[событие.код_клавиши] = да
    }

    function обработчик_поднимания_клавиш( событие ) {
      текущие_нажатые_клавиши[событие.код_клавиши] = нет
    }

    function обработчик_нажатий_клавиш() {
      // клавиша №33 'PageUp'
      if (текущие_нажатые_клавиши[33]) {
        скорость_тангажа = 0.1;
        // клавиша №34 'PageDown'
      } else if (текущие_нажатые_клавиши[34]) {
        // Page Down
        скорость_тангажа = -0.1;
      } else {
        скорость_тангажа = 0;
      }

      // клавиша №37 'стрелка влево' или №65 'Ф(рус)/A(анг)'
      if (текущие_нажатые_клавиши[37] || текущие_нажатые_клавиши[65]) {
        скорость_рыскания = 0.1;
        // клавиша №39 'стрелка вправо' или №68 'В(рус)/D(анг)'
      } else if (текущие_нажатые_клавиши[39] || текущие_нажатые_клавиши[68]) {
        // Right cursor key or D
        скорость_рыскания = -0.1;
      } else {
        скорость_рыскания = 0;
      }

      // клавиша №38 'стрелка вверх' или №87 'Ц(рус)/W(анг)'
      if (текущие_нажатые_клавиши[38] || текущие_нажатые_клавиши[87]) {
        скорость = 0.003;
      } else if (текущие_нажатые_клавиши[40] || текущие_нажатые_клавиши[83]) {
        // клавиша №40 'стрелка вниз' или №83 'Ы(рус)/S(анг)'
        скорость = -0.003;
      } else {
        скорость = 0;
      }
    }


  </script>

  <title>Урок 10. Загрузка мира и основы камеры</title>
</head>

<body>

<div id="контейнер">
  <canvas id="холст_1" width="500" height="500"></canvas>
  <div>
    <a href="index.html">< Назад</a>
  </div>
</div>

</body>
</html>